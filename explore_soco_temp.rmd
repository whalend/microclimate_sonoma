---
title: "Explore SoCo Temperature"
author: "whalen"
date: "June 12, 2015"
output: html_document
---

```{r load data}
long_temp <- readRDS("Temperature/eof_pred_long.rds")# long format
wide_temp <- readRDS("Temperature/eof_pred_wide.rds")
```

```{r examine/compare data structure}
str(long_temp)
str(wide_temp)
names(long_temp)
names(wide_temp)
summary(long_temp)
summary(wide_temp)
```


### Subset data to rainy season temperature variables for each sampling year

'rs' indicates "rainy season" with the two digits immediately following indicating the corresponding sampling year. For example, `rs04` indicates the 2004 rainy season, with dates from November 1st, 2003 through May 31st, 2004 (2003-11-01 to 2004-05-31).

```{r calculate hour counts, message=FALSE}
library(plyr); library(dplyr)

long_temp <- select(long_temp, -posix_time)
long_temp$date <- as.Date(long_temp$chr_date, format = "%Y-%m-%d %H")

rs04 <- long_temp %>% filter(date >= "2003-11-01" & date <= "2004-05-31")
rs04hrs <- rs04 %>% 
      filter(temp >= 14 & temp <= 20) %>% 
      group_by(plotid) %>% summarise(hrs04_14_20 = length(temp))
rs04hrs <- left_join(rs04hrs, rs04 %>% 
      filter(temp >= 25) %>% 
      group_by(plotid) %>% summarise(hrs04_abv25 = length(temp)),
      by = "plotid")
rs04hrs <- left_join(rs04hrs, rs04 %>% 
      filter(temp <= 10) %>% 
      group_by(plotid) %>% summarise(hrs04_blw10 = length(temp)),
      by = "plotid")
# The variable names are the rainy season and the threshold or range for which the number of hours were counted, i.e., 14_20 indicates a range between 14 and 20 C (inclusive), abv25 indicates number of times the temperature exceeded 25 C, blw10 indicates the number of times the temperature was below 10 C

# I'm not sure that the desicatting temperature (i.e. above 25 C) moakes much as a rainy season predictor. But should show very obviously that the temperatures seldom reach that high during this time of the year.

rs05 <- long_temp %>% filter(date >= "2004-11-01" & date <= "2005-05-31")
rs05hrs <- rs05 %>% filter(temp >= 14 & temp <= 20) %>% 
      group_by(plotid) %>% summarise(hrs05_14_20 = length(temp))
rs05hrs <- left_join(rs05hrs, rs05 %>% 
      filter(temp >= 25) %>% 
      group_by(plotid) %>% summarise(hrs05_abv25 = length(temp)),
      by = "plotid")
rs05hrs <- left_join(rs05hrs, rs05 %>% 
      filter(temp <= 10) %>% 
      group_by(plotid) %>% summarise(hrs05_blw10 = length(temp)),
      by = "plotid")

rs06 <- long_temp %>% filter(date >= "2005-11-01" & date <= "2006-05-31")
rs06hrs <- rs06 %>% filter(temp >= 14 & temp <= 20) %>% 
      group_by(plotid) %>% summarise(hrs06_14_20 = length(temp))
rs06hrs <- left_join(rs06hrs, rs06 %>% 
      filter(temp >= 25) %>% 
      group_by(plotid) %>% summarise(hrs06_abv25 = length(temp)),
      by = "plotid")
rs06hrs <- left_join(rs06hrs, rs06 %>% 
      filter(temp <= 10) %>% 
      group_by(plotid) %>% summarise(hrs06_blw10 = length(temp)),
      by = "plotid")

ls(pattern = "*hrs")

# rs_14_20 <- long_temp %>% filter(
#       date >= "2003-11-01" & date <= "2004-05-31" | 
#             date >= "2004-11-01" & date <= "2005-05-31" | 
#             date >= "2005-11-01" & date <= "2006-05-31" |
#             date >= "2006-11-01" & date <= "2007-05-31" |
#             date >= "2007-11-01" & date <= "2008-05-31" |
#             date >= "2008-11-01" & date <= "2009-05-31" |
#             date >= "2009-11-01" & date <= "2010-05-31" |
#             date >= "2010-11-01" & date <= "2011-05-31" |
#             date >= "2011-11-01" & date <= "2012-05-31" |
#             date >= "2013-11-01" & date <= "2014-05-31",
#       temp >= 14 & temp <= 20) %>% 
#       group_by(date, plotid) %>% summarise(hrs_14_20 = length(temp))
# 
# summary(rs_14_20)

rs07 <- long_temp %>% filter(date >= "2006-11-01" & date <= "2007-05-31")
rs07hrs <- left_join(rs07 %>% filter(temp >= 14 & temp <= 20) %>%
                           group_by(plotid) %>% 
                           summarise(hrs07_14_20 = length(temp)),
                     rs07 %>% filter(temp >= 25) %>% 
                           group_by(plotid) %>% 
                           summarise(hrs07_abv25 = length(temp)),
                     by = "plotid") %>% 
      left_join(., rs07 %>% filter(temp <= 10) %>% 
                           group_by(plotid) %>% 
                           summarise(hrs07_blw10 = length(temp)),
                by = "plotid")

rs06hrs <- rs06 %>% filter(temp >= 14 & temp <= 20) %>% 
      group_by(plotid) %>% summarise(hrs06_14_20 = length(temp))
rs06hrs <- left_join(rs06hrs, rs06 %>% 
      filter(temp >= 25) %>% 
      group_by(plotid) %>% summarise(hrs06_abv25 = length(temp)),
      by = "plotid")
rs06hrs <- left_join(rs06hrs, rs06 %>% 
      filter(temp <= 10) %>% 
      group_by(plotid) %>% summarise(hrs06_blw10 = length(temp)),
      by = "plotid")
rs08 <- long_temp %>% filter(date >= "2007-11-01" & date <= "2008-05-31")
rs09 <- long_temp %>% filter(date >= "2008-11-01" & date <= "2009-05-31")
rs10 <- long_temp %>% filter(date >= "2009-11-01" & date <= "2010-05-31")
rs11 <- long_temp %>% filter(date >= "2010-11-01" & date <= "2011-05-31")
rs12 <- long_temp %>% filter(date >= "2011-11-01" & date <= "2012-05-31")
rs14 <- long_temp %>% filter(date >= "2013-11-01" & date <= "2014-05-31")
      
      summarize(long_temp, daily_max_temp = max(temp), hrs_14_20 = count(temp >= 14 & temp <= 20))
      
summary(filter(long_temp, date == "2003-05-01"))
```


```{r plotting}
# Subset to fewer plots
dt <- long_temp %>%
      select(year, temp, plotid) %>%
      group_by(as.factor(year)) %>%
      filter(plotid == "ANN01" | plotid == "SUGAR23" | plotid == "FOP04")

qplot(x = posix_time, y = temp, 
      data = dt %>% 
            group_by(year) %>%
            summarise(avg_temp_yr = mean(temp)),
      facet = plotid ~ ., color = plotid, geom = c("point", "line")
            )
```

